// Items Sold
const items_for_sale_desktop = 
    {"budget": [

        {"name":"Cheese Power",
            "base display": 
                {
                    "cpu":"7600X3D",
                    "gpu":"RTX 4060",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"Ryzen 7 7600X3D", "price":"400"},
                    "gpu":{"name":"RTX 4060", "price":"400"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"Ryzen 7 7800X3D","price":"550"}],
                    "gpu":[{"name":"RTX 5070", "price":"600"}, {"name":"RTX 5080", "price":"1400"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["amd", "nvidia"]        
        },

        {"name":"Rat Rattling",
            "base display": 
                {
                    "cpu":"7600X3D",
                    "gpu":"7600 XT",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"Ryzen 7 7600X3D", "price":"400"},
                    "gpu":{"name":"7600 XT", "price":"500"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"Ryzen 7 7800X3D", "price":"550"}],
                    "gpu":[{"name":"7800 XT", "price":"700"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["amd"]
        },

        {"name":"Blue Grinder",
            "base display": 
                {
                    "cpu":"14600F",
                    "gpu":"RTX 4060",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"i5 14600F", "price":"325"},
                    "gpu":{"name":"RTX 4060", "price":"400"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"i7 14700KF", "price":"575"}, {"name":"Core Ultra 7 265KF", "price":"590"}],
                    "gpu":[{"name":"RTX 5070", "price":"600"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["intel", "nvidia"]   
        },
        
    ], 
"performance": [

        {"name":"Cheese Racer",
            "base display": 
                {
                    "cpu":"7600X3D",
                    "gpu":"RTX 4060",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"Ryzen 7 7600X3D", "price":"400"},
                    "gpu":{"name":"RTX 4060", "price":"400"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"Ryzen 7 7800X3D","price":"550"}],
                    "gpu":[{"name":"RTX 5070", "price":"600"}, {"name":"RTX 5080", "price":"2400"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["amd", "nvidia"]        
        },

        {"name":"Rat Speeder",
            "base display": 
                {
                    "cpu":"7600X3D",
                    "gpu":"7600 XT",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"Ryzen 7 7600X3D", "price":"400"},
                    "gpu":{"name":"7600 XT", "price":"500"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"Ryzen 7 7800X3D", "price":"550"}],
                    "gpu":[{"name":"7800 XT", "price":"700"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["amd"]
        },

        {"name":"Blue Grinder",
            "base display": 
                {
                    "cpu":"14600F",
                    "gpu":"RTX 4060",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"i5 14600F", "price":"325"},
                    "gpu":{"name":"RTX 4060", "price":"400"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"i7 14700KF", "price":"575"}, {"name":"Core Ultra 7 265KF", "price":"590"}],
                    "gpu":[{"name":"RTX 5070", "price":"600"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["intel", "nvidia"]  
        },
        
    ]}

const items_for_sale_laptop = 
    {"budget": [

        {"name":"Cheese Power",
            "base display": 
                {
                    "cpu":"7600X3D",
                    "gpu":"RTX 4060",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"Ryzen 7 7600X3D", "price":"400"},
                    "gpu":{"name":"RTX 4060", "price":"400"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"Ryzen 7 7800X3D","price":"550"}],
                    "gpu":[{"name":"RTX 5070", "price":"600"}, {"name":"RTX 5080", "price":"1400"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["amd", "nvidia"]        
        },

        {"name":"Rat Rattling",
            "base display": 
                {
                    "cpu":"7600X3D",
                    "gpu":"7600 XT",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"Ryzen 7 7600X3D", "price":"400"},
                    "gpu":{"name":"7600 XT", "price":"500"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"Ryzen 7 7800X3D", "price":"550"}],
                    "gpu":[{"name":"7800 XT", "price":"700"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["amd"]
        },

        {"name":"Blue Grinder",
            "base display": 
                {
                    "cpu":"14600F",
                    "gpu":"RTX 4060",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"i5 14600F", "price":"325"},
                    "gpu":{"name":"RTX 4060", "price":"400"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"i7 14700KF", "price":"575"}, {"name":"Core Ultra 7 265KF", "price":"590"}],
                    "gpu":[{"name":"RTX 5070", "price":"600"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["intel", "nvidia"]   
        },
        
    ], 
"performance": [

        {"name":"Cheese Racer",
            "base display": 
                {
                    "cpu":"7600X3D",
                    "gpu":"RTX 4060",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"Ryzen 7 7600X3D", "price":"400"},
                    "gpu":{"name":"RTX 4060", "price":"400"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"Ryzen 7 7800X3D","price":"550"}],
                    "gpu":[{"name":"RTX 5070", "price":"600"}, {"name":"RTX 5080", "price":"2400"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["amd", "nvidia"]        
        },

        {"name":"Rat Speeder",
            "base display": 
                {
                    "cpu":"7600X3D",
                    "gpu":"7600 XT",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"Ryzen 7 7600X3D", "price":"400"},
                    "gpu":{"name":"7600 XT", "price":"500"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"Ryzen 7 7800X3D", "price":"550"}],
                    "gpu":[{"name":"7800 XT", "price":"700"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["amd"]
        },

        {"name":"Blue Grinder",
            "base display": 
                {
                    "cpu":"14600F",
                    "gpu":"RTX 4060",
                    "ram":"16GB",
                    "storage":"512GB"
                },
                "base":
                {
                    "cpu":{"name":"i5 14600F", "price":"325"},
                    "gpu":{"name":"RTX 4060", "price":"400"},
                    "ram":{"name":"16GB", "price":"120"},
                    "storage":{"name":"512GB", "price":"90"}
                },
                "options":
                {
                    "cpu":[{"name":"i7 14700KF", "price":"575"}, {"name":"Core Ultra 7 265KF", "price":"590"}],
                    "gpu":[{"name":"RTX 5070", "price":"600"}],
                    "ram":[{"name":"32GB", "price":"240"}],
                    "storage":[{"name":"1TB", "price":"175"},{"name":"2TB", "price":"295"}]
                },
                "brands": ["intel", "nvidia"]  
        },
        
    ]}


const items_for_sale_parts = {
    cpu: [
        {"name":"i5 14600F", "price":"325", "brand":"intel"}, 
        {"name":"i7 14700KF", "price": "575", "brand":"intel"}, 
        {"name":"i9 14900KF", "price": "800", "brand":"intel"}, 
        {"name":"Core Ultra 7 265KF", "price":"590", "brand":"intel"}, 
        {"name":"Core Ultra 9 285K", "price": "850", "brand":"intel"}, 
        {"name":"Ryzen 7 7600X3D", "price": "400", "brand":"amd"}, 
        {"name":"Ryzen 7 7800X3D", "price": "675", "brand":"amd"},
        {"name":"Ryzen 9 7900X", "price": "795", "brand":"amd"},
        {"name":"Ryzen 9 7950X3D", "price": "830", "brand":"amd"}
    ],
    gpu: [
        {"name":"RTX 4060", "price":"400", "brand":"nvidia"},
        {"name":"RTX 5070", "price":"600", "brand":"nvidia"},
        {"name":"RTX 5080", "price":"2400", "brand":"nvidia"},
        {"name":"RTX 5090", "price":"5000", "brand":"nvidia"},
        {"name":"7600 XT", "price":"500", "brand":"amd"},
        {"name":"7800 XT", "price":"700", "brand":"amd"},
        {"name":"7900 XTX", "price":"1300", "brand":"amd"}
    ],
    ram: [
        {"name":"16GB", "price":"120"},
        {"name":"32GB", "price":"240"},
        {"name":"64GB", "price":"420"}
    ],
    storage: [
        {"name":"512GB", "price":"90"},
        {"name":"1TB", "price":"175"},
        {"name":"2TB", "price":"295"}
    ]
}

function loadproducts(tab, page, filter) {
    
    var catagory

    if (filter) {
        catagory = filter
    } else {
        if (page == "desktops.html") {
            catagory = items_for_sale_desktop[tab]
        }
        else if (page == "laptops.html") {
            catagory = items_for_sale_laptop[tab]
        } else if (page == "parts.html") {

            catagory = items_for_sale_parts[tab]
        }
    }
    const selection_div = document.getElementById("selection")

    if (page != "parts.html") {
    for (var i = 0; i < catagory.length; i++) {

        const item = catagory[i]
        
        // Create item option

        const item_option_bg = document.createElement("div")
        item_option_bg.classList.add("item-option")
        selection_div.appendChild(item_option_bg)

        const item_img = document.createElement("img")
        item_img.src = `img/${item.name}.jpeg`
        item_option_bg.appendChild(item_img)

        const info_div = document.createElement("div")
        item_option_bg.appendChild(info_div)

        const item_name = document.createElement("h3")
        item_name.innerHTML = item.name
        info_div.appendChild(item_name)

        const spec_div_1 = document.createElement("div")
        info_div.appendChild(spec_div_1)

        const cpu_spec = document.createElement("h5")
        cpu_spec.innerHTML = `CPU: ${item["base display"].cpu}`
        spec_div_1.appendChild(cpu_spec)

        const gpu_spec = document.createElement("h5")
        gpu_spec.innerHTML = `GPU: ${item["base display"].gpu}`
        spec_div_1.appendChild(gpu_spec)

        const spec_div_2 = document.createElement("div")
        spec_div_2.classList.add("hidden")
        info_div.appendChild(spec_div_2)

        const ram_spec = document.createElement("h5")
        ram_spec.innerHTML = `RAM: ${item["base display"].ram}`
        spec_div_2.appendChild(ram_spec)

        const storage_spec = document.createElement("h5")
        storage_spec.innerHTML = `Storage: ${item["base display"].storage}`
        spec_div_2.appendChild(storage_spec)

        const price_div = document.createElement("div")
        price_div.classList.add("hidden")
        info_div.appendChild(price_div)

        const base_total = Number(item.base.cpu.price) + Number(item.base.gpu.price) + Number(item.base.ram.price) + Number(item.base.storage.price)

        const price_text = document.createElement("h1")
        price_text.innerHTML = addcommasinnumber(base_total)
        price_div.appendChild(price_text)

        const customize_button_div = document.createElement("div")
        customize_button_div.classList.add("hidden")
        info_div.appendChild(customize_button_div)

        const customize_button = document.createElement("button")
        customize_button.classList.add("customize", "ubuntu-bold")
        customize_button.innerHTML = "Customize Now"
        customize_button.onclick = function() {customize(item, page)}
        customize_button_div.appendChild(customize_button)

    }} else {
        for (var i = 0; i < catagory.length; i++) {

            const part = catagory[i]
            const part_option_bg = document.createElement("div")
            part_option_bg.classList.add("item-option-part")
            selection_div.appendChild(part_option_bg)

            const part_img = document.createElement("img")
            part_img.src = `img/${part.name}.jpeg`
            part_option_bg.appendChild(part_img)

            const info_div = document.createElement("div")
            part_option_bg.appendChild(info_div)

            const product_name = document.createElement("h3")
            product_name.innerHTML = part.name
            info_div.appendChild(product_name)

            const price_div = document.createElement("div")
            price_div.classList.add("hidden")
            info_div.appendChild(price_div)

            const price_text = document.createElement("h1")
            price_text.innerHTML = addcommasinnumber(part.price)
            price_div.appendChild(price_text)

            const customize_button_div = document.createElement("div")
            customize_button_div.classList.add("hidden")
            info_div.appendChild(customize_button_div)

            const add_to_cart_button = document.createElement("button")
            add_to_cart_button.classList.add("add-to-cart-part", "ubuntu-bold")
            add_to_cart_button.innerHTML = "Add to Cart"
            add_to_cart_button.onclick = function() {addtocartpart(add_to_cart_button, part.name, part.price)}
            customize_button_div.appendChild(add_to_cart_button)

    }}

}


function filterapply(page) {

    selection.innerHTML = ""

    const current_tab = document.getElementsByClassName("active-tab")[0].id

    const min_price = Number(document.getElementById("min-price").value) || 0
    const max_price = Number(document.getElementById("max-price").value) || 0
    const nvidia_choice = document.getElementById("Nvidia").checked
    const intel_choice = document.getElementById("Intel").checked
    const amd_choice = document.getElementById("AMD").checked
    const min_cpu = document.getElementById("cpu-filter").value
    const min_gpu = document.getElementById("gpu-filter").value
    const min_ram = document.getElementById("ram-filter").value
    const min_storage = document.getElementById("storage-filter").value

    if (min_price == 0 && max_price == 0 && nvidia_choice == false && intel_choice == false && amd_choice == false && min_cpu == "All" && min_gpu == "All" && min_ram == "All" && min_storage == "All") {
        loadproducts(current_tab, page)
    }
    
    var filter = []

    if (page = "desktops.html") {
        const budget_filter_list = filtercheck(items_for_sale_desktop["budget"])
        const performance_filter_list = filtercheck(items_for_sale_desktop["performance"])
        const productivity_filter_list = filtercheck(items_for_sale_desktop["productivity"])
        const rgb_galore_filter_list = filtercheck(items_for_sale_desktop["rgb galore"])
        
        if (budget_filter_list) {
            budget_filter_list.forEach(product => {
                filter.push(product)
            })}

        if (performance_filter_list) {
            performance_filter_list.forEach(product => {
                filter.push(product)
            })}
        if (productivity_filter_list) {
            productivity_filter_list.forEach(product => {
                filter.push(product)
            })}

        if (rgb_galore_filter_list) {
            rgb_galore_filter_list.forEach(product => {
                filter.push(product)
            })}
        
        loadproducts("All", page, filter)
    }
    
}

function filtercheck(catagory) {

    if (!catagory) {
        return
    }

    const min_price = Number(document.getElementById("min-price").value) || 0
    const max_price = Number(document.getElementById("max-price").value) || 0
    const nvidia_choice = document.getElementById("Nvidia").checked
    const intel_choice = document.getElementById("Intel").checked
    const amd_choice = document.getElementById("AMD").checked
    const min_cpu = document.getElementById("cpu-filter").value
    const min_gpu = document.getElementById("gpu-filter").value
    const min_ram = document.getElementById("ram-filter").value
    const min_storage = document.getElementById("storage-filter").value

    var catagory_filter_list = []

    catagory.forEach(product => {
        const base_total = Number(product.base.cpu.price) + Number(product.base.gpu.price) + Number(product.base.ram.price) + Number(product.base.storage.price)

        var cpu_upgrades = []
        var gpu_upgrades = []
        var ram_upgrades = []
        var storage_upgrades = []

        for (let i = 0; i < product.options.cpu.length; i++) {
            const upgrade_option = product.options.cpu[i].name
            cpu_upgrades.push(upgrade_option)
        }
        for (let i = 0; i < product.options.gpu.length; i++) {
            const upgrade_option = product.options.gpu[i].name
            gpu_upgrades.push(upgrade_option)
        }
        for (let i = 0; i < product.options.ram.length; i++) {
            const upgrade_option = product.options.ram[i].name
            ram_upgrades.push(upgrade_option)
        }
        for (let i = 0; i < product.options.cpu.length; i++) {
            const upgrade_option = product.options.storage[i].name
            storage_upgrades.push(upgrade_option)
        }

        if (min_price < base_total && base_total < max_price) {
            catagory_filter_list.push(product)
        } else if (nvidia_choice && product.brands.includes("nvidia")) {
            catagory_filter_list.push(product)
        } else if (intel_choice && product.brands.includes("intel")) {
            catagory_filter_list.push(product)
        } else if (amd_choice && product.brands.includes("amd")) {
            catagory_filter_list.push(product)
        } else if (min_cpu != "All" && (product.base.cpu.name == min_cpu || cpu_upgrades.includes(min_cpu))) {
            catagory_filter_list.push(product)
        } else if (min_gpu != "All" && (product.base.gpu.name == min_gpu || gpu_upgrades.includes(min_gpu))) {
            catagory_filter_list.push(product)
        } else if (min_ram != "All" && (product.base.ram.name == min_ram || ram_upgrades.includes(min_ram))) {
            catagory_filter_list.push(product)
        } else if (min_storage != "All" && (product.base.storage.name == min_storage || storage_upgrades.includes(min_storage))) {
            catagory_filter_list.push(product)
        }
    })

    return catagory_filter_list

}

function filterapplyparts(page) {

    selection.innerHTML = ""

    const current_tab = document.getElementsByClassName("active-tab")[0].id

    const min_price = Number(document.getElementById("min-price").value) || 0
    const max_price = Number(document.getElementById("max-price").value) || 0
    const nvidia_choice = document.getElementById("Nvidia").checked
    const intel_choice = document.getElementById("Intel").checked
    const amd_choice = document.getElementById("AMD").checked

    if (min_price == 0 && max_price == 0 && nvidia_choice == false && intel_choice == false && amd_choice == false) {
        loadproducts(current_tab, page)
    }
    
    var filter = []

    if (page == "parts.html") {
        const cpu_filter_list = filtercheckparts(items_for_sale_parts["cpu"])
        const gpu_filter_list = filtercheckparts(items_for_sale_parts["gpu"])
        const ram_filter_list = filtercheckparts(items_for_sale_parts["ram"])
        const storage_filter_list = filtercheckparts(items_for_sale_parts["storage"])
        
        if (cpu_filter_list) {
            cpu_filter_list.forEach(product => {
                filter.push(product)
            })}

        if (gpu_filter_list) {
            gpu_filter_list.forEach(product => {
                filter.push(product)
            })}
        if (ram_filter_list) {
            ram_filter_list.forEach(product => {
                filter.push(product)
            })}

        if (storage_filter_list) {
            storage_filter_list.forEach(product => {
                filter.push(product)
            })}
        
        loadproducts("All", page, filter)
    }
    
}

function filtercheckparts(catagory) {

    if (!catagory) {
        return
    }

    const min_price = Number(document.getElementById("min-price").value) || 0
    const max_price = Number(document.getElementById("max-price").value) || 0
    const nvidia_choice = document.getElementById("Nvidia").checked
    const intel_choice = document.getElementById("Intel").checked
    const amd_choice = document.getElementById("AMD").checked

    var catagory_filter_list = []

    catagory.forEach(product => {

        if (min_price < product.price && product.price < max_price) {
            catagory_filter_list.push(product)
        } else if (nvidia_choice && product.brand == "nvidia") {
            catagory_filter_list.push(product)
        } else if (intel_choice && product.brand == "intel") {
            catagory_filter_list.push(product)
        } else if (amd_choice && product.brand == "amd") {
            catagory_filter_list.push(product)
    }})

    return catagory_filter_list

}

// Switches Catagories

function switchtab(element, page) {
    if (element.classList.contains("active-div")) {
        return
    } else {
        const active_tab = document.getElementsByClassName("active-tab")
        const selection = document.getElementById("selection")
        active_tab[0].classList.remove("active-tab")

        element.classList.add("active-tab")

        selection.innerHTML = ""
        loadproducts(element.id, page)
    }
}

function switchmode(next_mode) {
    var from
    var to

    const login_error_text = document.getElementById("login-error")
    const create_error_text = document.getElementById("create-error")

    if (!login_error_text.classList.contains("hidden-focus") || !create_error_text.classList.contains("hidden-focus")) {
        login_error_text.classList.add("hidden-focus")
        create_error_text.classList.add("hidden-focus")
    }
    if (next_mode == "create") {
        from = document.getElementsByClassName("login")
        to = document.getElementsByClassName("create")
    } else {
        from = document.getElementsByClassName("create")
        to = document.getElementsByClassName("login")
    }

    // Hide from group
    for (var i = 0; i < from.length; i++) {
        const element = from[i]
        element.classList.add("hidden-focus")
    }

    // Show to group
    for (var i = 0; i < to.length; i++) {
        const element = to[i]
        element.classList.remove("hidden-focus")
    }
}



function loginaccount() {


    const login_button = document.getElementById("login-account")


    login_button.disabled = true
    login_button.innerHTML = '<dotlottie-player src="https://lottie.host/8a0c36b9-eb34-425a-b8d9-44261e47e795/MxZsY2BrLb.lottie" background="transparent" speed="1" loop autoplay></dotlottie-player>'

    const error_text = document.getElementById("login-error")

    error_text.classList.add("hidden-focus")

    const entered_username = document.getElementById("username").value
    const entered_password = document.getElementById("password").value

    // Check if username or password is entered

    if (entered_username == "") {
        error_text.innerHTML = "Please enter a username"
    } else if (entered_password == "") {
        error_text.innerHTML = "Please enter a password"
    }

    if (entered_username == "" || entered_password == "") {
        error_text.classList.remove("hidden-focus")
        login_button.disabled = false
        login_button.innerHTML = "Login"
        return
    }

    const APIKEY = "67a65abedf7c2681359657b8"

    let settings = {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          "x-apikey": APIKEY,
          "Cache-Control": "no-cache"
        },
    } 

    // Get Account Records

    fetch("https://rattechnologies-dab8.restdb.io/rest/rat-technologies-accounts", settings)
    .then(users => users.json())
    .then(users => {

        // Find if account exists

        let username_found = false

        users.forEach(user_info => {
            if (entered_username == user_info.username) {
                username_found = true
             if (entered_password == user_info.password) {
     
                 const prev_page = localStorage.getItem("previous")
                 localStorage.setItem("login data", JSON.stringify(user_info))
                 window.location.href = prev_page
     
             } else {
                 error_text.innerHTML = "Password is incorrect"
                 error_text.classList.remove("hidden-focus")
                
                 }
            }
         });

         if (username_found == false) {
            error_text.innerHTML = "Username not found"
            error_text.classList.remove("hidden-focus")
        }

        login_button.disabled = false
        login_button.innerHTML = "Login"

    })
}

function createaccount() {

    const create_button = document.getElementById("create-account")

    create_button.disabled = false
    create_button.innerHTML = '<dotlottie-player src="https://lottie.host/8a0c36b9-eb34-425a-b8d9-44261e47e795/MxZsY2BrLb.lottie" background="transparent" speed="1" loop autoplay></dotlottie-player>'

    const error_text = document.getElementById("create-error")

    error_text.classList.add("hidden-focus")

    const entered_username = document.getElementById("new-username").value
    const entered_password = document.getElementById("new-password").value

    if (entered_username == "") {
        error_text.innerHTML = "Please enter a username"
    } else if (entered_password == "") {
        error_text.innerHTML = "Please enter a password"
    }

    if (entered_username == "" || entered_password == "") {
        error_text.classList.remove("hidden-focus")
        create_button.disabled = false
        create_button.innerHTML = "Create Account"
        return
    }

    const APIKEY = "67a65abedf7c2681359657b8"

    let settings = {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          "x-apikey": APIKEY,
          "Cache-Control": "no-cache"
        },
    } 

    // Get Account Records

    fetch("https://rattechnologies-dab8.restdb.io/rest/rat-technologies-accounts", settings)
    .then(users => users.json())
    .then(users => {
        
        // Find if account exists

        var username_found = false

        users.forEach(user_info => {
            if (entered_username == user_info.username) {
                username_found = true
            }
        })


        if (username_found) {
            error_text.innerHTML = "Account already exists"
            error_text.classList.remove("hidden-focus")

            create_button.disabled = false
            create_button.innerHTML = "Create Account"
            return true
    }
    }).then(account_found => {

        if (account_found) {
            return
        }

        // If no records

        const new_user = {"username":`${entered_username}`, "password":`${entered_password}`, "points":0}

        settings = {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "x-apikey": APIKEY,
                "Cache-Control": "no-cache"
            },
            body: JSON.stringify(new_user),
        }

        fetch("https://rattechnologies-dab8.restdb.io/rest/rat-technologies-accounts", settings)
        .then(response => response.json())
        .then(response => {

            const prev_page = localStorage.getItem("previous")
            localStorage.setItem("login data", JSON.stringify(new_user))
            window.location.href = prev_page

        })
    })

}

function tologin(previousPage) {
    localStorage.setItem("previous", previousPage)
    window.location.href = "login.html"
}

// Loads or unloads account info and log out button

function accountinfo() {
    const account_info_div = document.getElementById("account-info")
    if (account_info_div.classList.contains("hidden-focus")) {
        account_info_div.classList.remove("hidden-focus")
    } else {
        account_info_div.classList.add ("hidden-focus")
    }
}

// Checks if user is logged in

function checklogin() {
    const login_data = localStorage.getItem("login data")
    const login_button = document.getElementById("navbar-login")
    if (login_data != undefined) {
        const login_data_JSON = JSON.parse(login_data)
        login_button.innerHTML = login_data_JSON.username
        document.getElementById("account-points").innerHTML = `Points: ${login_data_JSON.points}`
        login_button.onclick = function() {accountinfo()}
    }
}

// Logs out

function logout() {
    localStorage.removeItem("login data")
    window.location.reload()
}

function customize(item, previousPage) {
    localStorage.setItem("item", JSON.stringify(item))
    localStorage.setItem("previous", previousPage)
    window.location.href = "customize.html"
}

function customizepageloaded() {

    // Load Product

    const product_item = JSON.parse(localStorage.getItem("item"))

    const Product_Name_Display = document.getElementById("itemname")
    Product_Name_Display.dataset.name = product_item.name
    Product_Name_Display.innerHTML = product_item.name

    const CPU_Options = document.getElementById("cpu")

    const CPU_Base_Option = document.createElement("option")
    CPU_Base_Option.value = JSON.stringify(product_item.base.cpu)
    CPU_Base_Option.innerHTML = `${product_item.base.cpu.name} -- Base`
    CPU_Options.appendChild(CPU_Base_Option)

    for (var i = 0; i < Object.keys(product_item.options.cpu).length; i++) {
        const option = product_item.options.cpu[i]

        const CPU_Option = document.createElement("option")
        CPU_Option.value = JSON.stringify(option)
        CPU_Option.innerHTML = `${option.name} -- ${addcommasinnumber(Number(option.price) - Number(product_item.base.cpu.price))}`
        CPU_Options.appendChild(CPU_Option)
    }

    const GPU_Options = document.getElementById("gpu")

    const GPU_Base_Option = document.createElement("option")
    GPU_Base_Option.value = JSON.stringify(product_item.base.gpu)
    GPU_Base_Option.innerHTML = `${product_item.base.gpu.name} -- Base`
    GPU_Options.appendChild(GPU_Base_Option)

    for (var i = 0; i < Object.keys(product_item.options.gpu).length; i++) {
        const option = product_item.options.gpu[i]

        const GPU_Option = document.createElement("option")
        GPU_Option.value = JSON.stringify(option)
        GPU_Option.innerHTML = `${option.name} -- ${addcommasinnumber(Number(option.price) - Number(product_item.base.gpu.price))}`
        GPU_Options.appendChild(GPU_Option)
    }

    const RAM_Options = document.getElementById("ram")

    const RAM_Base_Option = document.createElement("option")
    RAM_Base_Option.value = JSON.stringify(product_item.base.ram)
    RAM_Base_Option.innerHTML = `${product_item.base.ram.name} -- Base`
    RAM_Options.appendChild(RAM_Base_Option)

    for (var i = 0; i < Object.keys(product_item.options.ram).length; i++) {
        const option = product_item.options.ram[i]

        const RAM_Option = document.createElement("option")
        RAM_Option.value = JSON.stringify(option)
        RAM_Option.innerHTML = `${option.name} -- ${addcommasinnumber(Number(option.price) - Number(product_item.base.ram.price))}`
        RAM_Options.appendChild(RAM_Option)
    }

    const Storage_Options = document.getElementById("storage")

    const Storage_Base_Option = document.createElement("option")
    Storage_Base_Option.value = JSON.stringify(product_item.base.storage)
    Storage_Base_Option.innerHTML = `${product_item.base.storage.name} -- Base`
    Storage_Options.appendChild(Storage_Base_Option)

    for (var i = 0; i < Object.keys(product_item.options.storage).length; i++) {
        const option = product_item.options.storage[i]

        const Storage_Option = document.createElement("option")
        Storage_Option.value = JSON.stringify(option)
        Storage_Option.innerHTML = `${option.name} -- ${addcommasinnumber(Number(option.price) - Number(product_item.base.storage.price))}`
        Storage_Options.appendChild(Storage_Option)
    }

    const base_total = Number(product_item.base.cpu.price) + Number(product_item.base.gpu.price) + Number(product_item.base.ram.price) + Number(product_item.base.storage.price)

    document.getElementById("total-text").dataset.total = base_total
    document.getElementById("total-text").innerHTML = addcommasinnumber(base_total)

    // Load Reviews

    loadreviews()
    
    // Load Rating
    
    const stars_div = document.getElementById("stars")

    const total_reviews = Number(stars_div.dataset.totalreviews)

    const avg_rating = Math.round(Number(stars_div.dataset.totalstars) / total_reviews)

    document.getElementById("total-reviews").innerHTML = `(${total_reviews})`

    loadrating(avg_rating, stars_div)
}

// Load Rating

function loadrating(rating, parentNode) {
    for (i = 1; i <= 5; i++) {
        if (i <= rating) {
            const filled_star = document.createElement("img")
            filled_star.src = "svg/filled-star.svg"
            parentNode.appendChild(filled_star)
        } else {
            const star = document.createElement("img")
            star.src = "svg/star.svg"
            parentNode.appendChild(star)
        }
    }
}

function loadreviews() {

    const reviews_list = document.getElementById("reviews")

    // Test Sample

    const reviews = [
        {"id":`${guidGenerator()}`,"username":"SaucyJack","rating":"3","review":"Kudbebedda","helpful":"73"},
        {"id":`${guidGenerator()}`,"username":"AEEEEEE","rating":"5","review":"Massive W","helpful":"23"},
        {"id":`${guidGenerator()}`,"username":"Walter White","rating":"1","review":"Absolute Dogwater","helpful":"0"},
        {"id":`${guidGenerator()}`,"username":"SaucyJack","rating":"3","review":"Kudbebedda","helpful":"73"},
        {"id":`${guidGenerator()}`,"username":"AEEEEEE","rating":"5","review":"Massive W","helpful":"23"},
        {"id":`${guidGenerator()}`,"username":"Walter White","rating":"1","review":"Absolute Dogwater","helpful":"0"},
        {"id":`${guidGenerator()}`,"username":"SaucyJack","rating":"3","review":"Kudbebedda","helpful":"73"},
        {"id":`${guidGenerator()}`,"username":"AEEEEEE","rating":"5","review":"Massive W","helpful":"23"},
        {"id":`${guidGenerator()}`,"username":"Walter White","rating":"1","review":"Absolute Dogwater","helpful":"0"},
        {"id":`${guidGenerator()}`,"username":"SaucyJack","rating":"3","review":"Kudbebedda","helpful":"73"},
        {"id":`${guidGenerator()}`,"username":"AEEEEEE","rating":"5","review":"Massive W","helpful":"23"},
        {"id":`${guidGenerator()}`,"username":"Walter White","rating":"1","review":"Absolute Dogwater","helpful":"0"},
        {"id":`${guidGenerator()}`,"username":"SaucyJack","rating":"3","review":"Kudbebedda","helpful":"73"},
        {"id":`${guidGenerator()}`,"username":"AEEEEEE","rating":"5","review":"Massive W","helpful":"23"},
        {"id":`${guidGenerator()}`,"username":"Walter White","rating":"1","review":"Absolute Dogwater","helpful":"0"},
        {"id":`${guidGenerator()}`,"username":"SaucyJack","rating":"3","review":"Kudbebedda","helpful":"73"},
        {"id":`${guidGenerator()}`,"username":"AEEEEEE","rating":"5","review":"Massive W","helpful":"23"},
        {"id":`${guidGenerator()}`,"username":"Walter White","rating":"1","review":"Absolute Dogwater","helpful":"0"},
        {"id":`${guidGenerator()}`,"username":"SaucyJack","rating":"3","review":"Kudbebedda","helpful":"73"},
        {"id":`${guidGenerator()}`,"username":"AEEEEEE","rating":"5","review":"Massive W","helpful":"23"},
        {"id":`${guidGenerator()}`,"username":"Walter White","rating":"1","review":"Absolute Dogwater","helpful":"0"},
        {"id":`${guidGenerator()}`,"username":"SaucyJack","rating":"3","review":"Kudbebedda","helpful":"73"},
        {"id":`${guidGenerator()}`,"username":"AEEEEEE","rating":"5","review":"Massive W","helpful":"23"},
        {"id":`${guidGenerator()}`,"username":"Walter White","rating":"1","review":"Absolute Dogwater","helpful":"0"},
    ]

    const reviews_displayed = Number(reviews_list.dataset.showing)

    var new_reviews_displayed = Number(reviews_list.dataset.showing)

    document.getElementById("load-more").remove()

    for (var i = 0; (reviews.length - reviews_displayed >= 5 ? i < 5 : i < reviews.length - reviews_displayed); i++) {

        const review = reviews[reviews_displayed + i]

        // Create Review Element

        const review_bg = document.createElement("div")
        review_bg.classList.add("review", "ubuntu-medium")
        reviews_list.appendChild(review_bg)

        const content_div = document.createElement("div")
        content_div.classList.add("review-content")
        review_bg.appendChild(content_div)

        const profile_img = document.createElement("img")
        profile_img.src = "img/placeholder.jpeg" //Get Profile Pic From account database later
        content_div.appendChild(profile_img)
        
        const content_div_no_pic = document.createElement("div")
        content_div.appendChild(content_div_no_pic)

        const username = document.createElement("h5")
        username.classList.add("username")
        username.innerHTML = review.username
        content_div_no_pic.appendChild(username)

        const rating_bg = document.createElement("div")
        rating_bg.classList.add("review-rating")
        content_div_no_pic.appendChild(rating_bg)

        loadrating(Number(review.rating), rating_bg)

        const review_content = document.createElement("h5")
        review_content.innerHTML = review.review
        content_div_no_pic.appendChild(review_content)

        const button_align = document.createElement("div")
        button_align.classList.add("button-align")
        review_bg.appendChild(button_align)

        const helpful_amount_text = document.createElement("label")
        helpful_amount_text.classList.add("helpful-amount", `${review.id}`)
        helpful_amount_text.innerHTML = `${review.helpful} Found This Helpful.`
        helpful_amount_text.dataset.amount = review.helpful
        button_align.appendChild(helpful_amount_text)

        const question_text = document.createElement("label")
        question_text.classList.add("helpful-text", `${review.id}`)
        question_text.innerHTML = "Is This Helpful?"
        button_align.appendChild(question_text)

        const agree_button = document.createElement("button")
        agree_button.classList.add("helpful-button", "helpful-agree", "helpful-option", `${review.id}`)
        agree_button.innerHTML = "Yes"
        agree_button.onclick = function() {helpfulagree(review.id)}
        button_align.appendChild(agree_button)

        const disagree_button = document.createElement("button")
        disagree_button.classList.add("helpful-button", "helpful-disagree", "helpful-option", `${review.id}`)
        disagree_button.innerHTML = "No"
        disagree_button.onclick = function() {helpfuldisagree(review.id)}
        button_align.appendChild(disagree_button)

        new_reviews_displayed++
    }

    if (new_reviews_displayed % 5 == 0) {
        const load_more_button_bg = document.createElement("div")
        load_more_button_bg.id = "load-more"
        reviews_list.appendChild(load_more_button_bg)

        const load_more_button = document.createElement("button")
        load_more_button.id = "load-more-button"
        load_more_button.innerHTML = "Load More"
        load_more_button.onclick = function() {loadreviews()}
        load_more_button_bg.appendChild(load_more_button)
    }

    reviews_list.dataset.showing = new_reviews_displayed    
}

// Called when the option changes

function optionchanged() {
    
    const cpu_price = Number(JSON.parse(document.getElementById("cpu").value).price)
    const gpu_price = Number(JSON.parse(document.getElementById("gpu").value).price)
    const ram_price = Number(JSON.parse(document.getElementById("ram").value).price)
    const storage_price = Number(JSON.parse(document.getElementById("storage").value).price)
    const monitor_price = Number(JSON.parse(document.getElementById("monitor").value).price)
    const peripherals_price = Number(JSON.parse(document.getElementById("peripherals").value).price)
    const osver_price = Number(JSON.parse(document.getElementById("osver").value).price)

    const current_total = cpu_price + gpu_price + ram_price + storage_price + monitor_price + peripherals_price + osver_price
    const points = Math.round(current_total / 3)

    const total_text = document.getElementById("total-text")
    const points_text = document.getElementById("points-text")

    total_text.dataset.total = current_total
    points_text.dataset.points = points

    total_text.innerHTML = addcommasinnumber(current_total)
    points_text.innerHTML = `You will earn: ${points} Points`
}

function addtocart() {
    const screen_blur = document.getElementById("screen-blur")
    const item_bought_align = document.getElementById("item-bought-align")

    // Add to cart
    
    var cart = JSON.parse(localStorage.getItem("cart")) || []

    // Get item info

    const item_name = document.getElementById("itemname").dataset.name
    const cpu_choice = JSON.parse(document.getElementById("cpu").value).name
    const gpu_choice = JSON.parse(document.getElementById("gpu").value).name
    const ram_choice = JSON.parse(document.getElementById("ram").value).name
    const storage_choice = JSON.parse(document.getElementById("storage").value).name
    const monitor_choice = JSON.parse(document.getElementById("monitor").value).name
    const peripherals_choice = JSON.parse(document.getElementById("peripherals").value).name
    const osver_choice = JSON.parse(document.getElementById("osver").value).name

    // Get Total & Points

    const total = document.getElementById("total-text").dataset.total
    const points = document.getElementById("points-text").dataset.points
    
    // Genereate a unique ID

    const id = guidGenerator()

    const item = {"type": "prebuilt" ,"id" : id, "name" : item_name, "cpu" : cpu_choice, "gpu" : gpu_choice, "ram" : ram_choice, "storage" : storage_choice, "monitor" : monitor_choice, "peripherals" : peripherals_choice, "osver" : osver_choice, "total" : total, "points" : points}

    // Add to cart list
    cart.push(item)

    localStorage.setItem("cart", JSON.stringify(cart))

    // Blur out the page

    screen_blur.classList.add("cardshow")
    item_bought_align.classList.add("cardshow")
}

function addtocartpart(button, name, price) {

    button.innerHTML = `<dotlottie-player class="add-to-cart-part-anim" src="https://lottie.host/a69dfd67-5d73-4bb0-8c7f-d93705d64c43/mxM3JieP9l.lottie" background="transparent" speed="0.8" autoplay></dotlottie-player>`
    
    const screen_blur = document.getElementById("screen-blur")
    const item_bought_align = document.getElementById("item-bought-align")

    // Add to cart
    
    var cart = JSON.parse(localStorage.getItem("cart")) || []

    const id = guidGenerator()

    const item = {"type": "part", "id": id, "name":name, "price":price}

    // Add to cart list
    cart.push(item)

    localStorage.setItem("cart", JSON.stringify(cart))
}

function helpfulagree(review_id,) {
    helpfulchange(review_id, true)
}

function helpfuldisagree(review_id) {
    helpfulchange(review_id, false)
}

function helpfulchange(review_id, helpful) {
    const reviewelements = document.getElementsByClassName(review_id)
    for (var i = 0; i < reviewelements.length; i++) {
        var element = reviewelements.item(i)
        if (element.classList.contains("helpful-button")) {
            element.remove()
            i--
        } else if (element.classList.contains("helpful-text")) {
            element.innerHTML = "Thank You for your feedback"
        } else if (element.classList.contains("helpful-amount") && helpful) {
            element.dataset.amount++
            element.innerHTML = `${element.dataset.amount} Found This Helpful.`
        }
    }
}

function goback() {
    const prev_page = localStorage.getItem("previous") ? localStorage.getItem("previous") : "index.html"
    window.location.href = prev_page
}

function remove_item(item_id) {
    const item_element = document.getElementsByClassName(item_id)

    const cart = JSON.parse(localStorage.getItem("cart"))

    cart.forEach(item => {
        if (item.id == item_id) {
            const index = cart.indexOf(item)
            if (index > -1) {
                cart.splice(index, 1)
                localStorage.setItem("cart", JSON.stringify(cart))

                const total_display = document.getElementById("total-amount")
                const gst_display = document.getElementById("gst-amount")
                const points_display = document.getElementById("points-amount")
                const payable_display = document.getElementById("amount-payable")

                const new_total = Number(total_display.dataset.amount) - Number(item.total)
                const new_gst = (new_total * 0.09)
                const new_points = Number(points_display.dataset.amount) - Number(item.points)
                const new_payable = (new_total + new_gst)

                total_display.dataset.amount = new_total
                total_display.innerHTML = addcommasinnumber(new_total)

                gst_display.dataset.amount = new_gst
                gst_display.innerHTML = addcommasinnumber(new_gst.toFixed(2))

                points_display.dataset.amount = new_points
                points_display.innerHTML = new_points

                payable_display.dataset.amount = new_payable
                payable_display.innerHTML = addcommasinnumber(new_payable.toFixed(2))
            }
        }
    })
    
    for (var i = 0; i < item_element.length;) {
        item_element.item(i).remove()
    }
}

function gettotal() {
    const cart = JSON.parse(localStorage.getItem("cart"))
    const items_div = document.getElementById("items")
    const items = items_div.children
    const bill = document.getElementById("bill")

    var total_points = 0
    // Create Item

    cart.forEach(item => {

        if (item.type == "prebuilt") {

        // Add points to total

        total_points += Number(item.points) 

        // Item Div Background
        
        const item_bg = document.createElement("div")
        item_bg.classList.add("item", item.id)
        item_bg.dataset.itemname = item.name
        item_bg.dataset.cost = item.total
        item_bg.dataset.points = item.points
        item_bg.dataset.id = item.id
        items_div.appendChild(item_bg)

        // Item Image

        const item_img = document.createElement("img")
        item_img.classList.add("item-img")
        item_img.src = `img/${item.name}.jpeg`
        item_bg.appendChild(item_img)

        // Item Specs Div

        const item_specs_bg = document.createElement("div")
        item_specs_bg.classList.add("item-specs", "ubuntu-medium")
        item_bg.appendChild(item_specs_bg)

        // Item Name

        const item_name = document.createElement("h1")
        item_name.innerHTML = item.name
        item_specs_bg.appendChild(item_name)
        
        // CPU Spec

        const cpu_choice = document.createElement("h4")
        cpu_choice.innerHTML = `CPU: ${item.cpu}`
        item_specs_bg.appendChild(cpu_choice)
                
        // GPU Spec

        const gpu_choice = document.createElement("h4")
        gpu_choice.innerHTML = `GPU: ${item.gpu}`
        item_specs_bg.appendChild(gpu_choice)
                        
        // RAM Spec

        const ram_choice = document.createElement("h4")
        ram_choice.innerHTML = `RAM: ${item.ram}`
        item_specs_bg.appendChild(ram_choice)
                        
        // Storage Spec

        const storage_choice = document.createElement("h4")
        storage_choice.innerHTML = `Storage: ${item.storage}`
        item_specs_bg.appendChild(storage_choice)
                        
        // OS Version Choice

        const osver_choice = document.createElement("h4")
        osver_choice.innerHTML = `GPU: ${item.osver}`
        item_specs_bg.appendChild(osver_choice)
                        
        // Monitor Choice

        const monitor_choice = document.createElement("h4")
        monitor_choice.innerHTML = `Monitor: ${item.monitor}`
        item_specs_bg.appendChild(monitor_choice)
                        
        // Peripherals Choice

        const peripherals_choice = document.createElement("h4")
        peripherals_choice.innerHTML = `Peripherals: ${item.peripherals}`
        item_specs_bg.appendChild(peripherals_choice)

        // Remove Button

        const remove_button = document.createElement("button")
        remove_button.classList.add("remove-button", "ubuntu-bold")
        remove_button.onclick = function() {remove_item(item.id)}
        remove_button.innerHTML = "Remove"
        item_specs_bg.appendChild(remove_button)
        } else {

            const item_bg = document.createElement("div")
            item_bg.classList.add("item", item.id)
            item_bg.dataset.itemname = item.name
            item_bg.dataset.cost = item.price
            item_bg.dataset.points = 0
            item_bg.dataset.id = item.id
            items_div.appendChild(item_bg)

            const item_img = document.createElement("img")
            item_img.classList.add("item-img")
            item_img.src = `img/${item.name}.jpeg`
            item_bg.appendChild(item_img)

            const item_specs_bg = document.createElement("div")
            item_specs_bg.classList.add("item-specs-part", "ubuntu-medium")
            item_bg.appendChild(item_specs_bg)

            const item_name = document.createElement("h1")
            item_name.innerHTML = item.name
            item_specs_bg.appendChild(item_name)

            const remove_button = document.createElement("button")
            remove_button.classList.add("remove-button", "ubuntu-bold")
            remove_button.onclick = function() {remove_item(item.id)}
            remove_button.innerHTML = "Remove"
            item_specs_bg.appendChild(remove_button)
        }
    });

    var total = 0

    for (var i = 0; i < items.length; i++) {
        const item = items.item(i)
        const cost = Number(item.dataset.cost)
        const item_id = item.dataset.id
        const item_name = item.dataset.itemname

        total += cost

        const cost_string = addcommasinnumber(cost)

        // Create Item Bill

        const bill_bg = document.createElement("div")
        bill_bg.classList.add("item-bill")
        bill_bg.classList.add(item_id)
        bill.appendChild(bill_bg)

        const bill_item_name = document.createElement("h4")
        bill_item_name.classList.add("item-name")
        bill_item_name.innerHTML = item_name
        bill_bg.appendChild(bill_item_name)

        const bill_item_cost = document.createElement("h4")
        bill_item_cost.classList.add("item-cost")
        bill_item_cost.innerHTML = cost_string
        bill_bg.appendChild(bill_item_cost)
    }

    // Create Final Cost
    
    const final_bg = document.createElement("div")
    final_bg.id = "total-cost-points"
    bill.appendChild(final_bg)

    // Total Cost before GST

    const total_string = addcommasinnumber(total)

    const total_cost_bg = document.createElement("div")
    total_cost_bg.classList.add("item-bill")
    total_cost_bg.id = "total-item-cost-div"
    final_bg.appendChild(total_cost_bg)

    const total_text = document.createElement("h4")
    total_text.classList.add("item-name")
    total_cost_bg.appendChild(total_text)
    total_text.innerHTML = "Total"

    const total_cost = document.createElement("h4")
    total_cost.classList.add("item-cost")
    total_cost.id = "total-amount"
    total_cost.dataset.amount = total
    total_cost_bg.appendChild(total_cost)
    total_cost.innerHTML = total_string


    // GST

    const GST = (total * 0.09).toFixed(2)

    const GST_string = addcommasinnumber(GST)

    const GST_bg = document.createElement("div")
    GST_bg.classList.add("item-bill")
    final_bg.appendChild(GST_bg)

    const GST_text = document.createElement("h4")
    GST_text.classList.add("item-name")
    GST_bg.appendChild(GST_text)
    GST_text.innerHTML = "GST"

    const GST_cost = document.createElement("h4")
    GST_cost.classList.add("item-cost")
    GST_cost.id = "gst-amount"
    GST_cost.dataset.amount = GST
    GST_bg.appendChild(GST_cost)
    GST_cost.innerHTML = GST_string

    // Points

    const Points_bg = document.createElement("div")
    Points_bg.classList.add("item-bill")
    final_bg.appendChild(Points_bg)

    const Points_text = document.createElement("h4")
    Points_text.classList.add("item-name")
    Points_bg.appendChild(Points_text)
    Points_text.innerHTML = "Points Earned"

    const Points_amount = document.createElement("h4")
    Points_amount.classList.add("item-cost")
    Points_amount.id = "points-amount"
    Points_amount.dataset.amount = total_points
    Points_bg.appendChild(Points_amount)
    Points_amount.innerHTML = total_points

    // Amount Payable

    const To_Pay = (total + parseFloat(GST)).toFixed(2)

    const To_Pay_String = addcommasinnumber(To_Pay)

    const To_Pay_bg = document.createElement("div")
    To_Pay_bg.classList.add("item-bill")
    final_bg.appendChild(To_Pay_bg)

    const To_Pay_text = document.createElement("h4")
    To_Pay_text.classList.add("item-name")
    To_Pay_bg.appendChild(To_Pay_text)
    To_Pay_text.innerHTML = "To Pay"

    const To_Pay_amount = document.createElement("h4")
    To_Pay_amount.classList.add("item-cost")
    To_Pay_amount.id = "amount-payable"
    To_Pay_amount.dataset.amount = To_Pay
    To_Pay_bg.appendChild(To_Pay_amount)
    To_Pay_amount.innerHTML = To_Pay_String
    To_Pay_amount.dataset.usepoints = false

    // Point Option
    document.getElementById("point-option").dataset.points = JSON.parse(localStorage.getItem("login data")).points
    document.getElementById("point-option-text").innerHTML = `Use Points (S$${Number(document.getElementById("point-option").dataset.points)/100})`

}

function payment() {
    const card_payment_option = document.getElementById("payment-option0").checked
    
    if (!card_payment_option) {
        return
    }

    var Payable_Amount = document.getElementById("amount-payable").dataset.amount
    const Points_to_Earn = document.getElementById("points-amount").dataset.amount
    const usepoints = document.getElementById("amount-payable").dataset.usepoints

    if (usepoints) {
        Payable_Amount = Number(Payable_Amount) - (JSON.parse(localStorage.getItem("login data")).points / 100)
    }

    localStorage.setItem("Payable_Amount", Payable_Amount)
    localStorage.setItem("Earned_Points", Points_to_Earn)
    localStorage.setItem("Using_Points", usepoints)

    window.location.href = "cardpayment.html"
}

function addcommasinnumber(value) {
    var value_string = "S$"

    // number of digits in the first set
    
    const first_set_amount = value.toString().length % 3

    for (var i = 0; i < value.toString().length; i++) {
        const digit = value.toString()[i]
        const placement = i + 1
        
        value_string += digit

        // Add in the commas between the numbers

        if ((placement - first_set_amount)% 3 == 0 && placement != value.toString().length && value.toString()[placement] != ".") {
            value_string += ","
        } 
    }

    return value_string
}

// Generates an id
function guidGenerator() {
    var S4 = function() {
       return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
    };
    return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
}

// Point option selected

if (document.getElementById("point-option")) {
document.getElementById("point-option0").addEventListener("click", function() {
    const Payable_Amount_Display = document.getElementById("amount-payable")
    const Point_Option = document.getElementById("point-option")
    const Total_Display = document.getElementById("amount-payable")

    if (document.getElementById("point-option0").checked) {
        const Point_to_Dollars = Point_Option.dataset.points / 100
        const Payable_Amount_After_Points = Payable_Amount_Display.dataset.amount - Point_to_Dollars

        const Payable_Amount_After_Points_String = addcommasinnumber(Number(Payable_Amount_After_Points).toFixed(2))

        Total_Display.innerHTML = Payable_Amount_After_Points_String
        Total_Display.dataset.usepoints = true
        
    } else {
        const Payable_Amount_String = addcommasinnumber(Number(Total_Display.dataset.amount).toFixed(2))

        Total_Display.innerHTML = Payable_Amount_String
        Total_Display.dataset.usepoints = false
    }
})}

// When Login Button is loaded
document.getElementById("navbar-login").onload = checklogin()

// Payment Page is loaded
function payment_page_loaded() {
    const amount_payable = localStorage.getItem("Payable_Amount")

    document.getElementById("to-pay").innerHTML = `<h3>Amount Payable: ${addcommasinnumber(Number(amount_payable).toFixed(2))}`
}

function cardpay() {

    var login_data = JSON.parse(localStorage.getItem("login data"))
    
    if (!login_data) {
        window.location.href = "index.html"
        return
    }

    const pay_button = document.getElementById("pay")
    pay_button.disabled = true
    pay_button.innerHTML = '<dotlottie-player src="https://lottie.host/8a0c36b9-eb34-425a-b8d9-44261e47e795/MxZsY2BrLb.lottie" background="transparent" speed="1" loop autoplay></dotlottie-player>'
    pay_button.style.borderStyle = "solid none none solid"
    pay_button.style.borderColor = "black"
    const points_earned = localStorage.getItem("Earned_Points")
    const useponts = localStorage.getItem("Using_Points")

    if (useponts) {
        login_data.points = 0
    }

    login_data.points = Number(login_data.points) + Number(points_earned)

    new_account_data = {"username":login_data.username, "password":login_data.password, "points":login_data.points}

    const APIKEY = "67a65abedf7c2681359657b8"

    var settings = {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "x-apikey": APIKEY,
          "Cache-Control": "no-cache"
        },
        body: JSON.stringify(new_account_data)
      }
  
    fetch(`https://rattechnologies-dab8.restdb.io/rest/rat-technologies-accounts/${login_data._id}`, settings)
    .then(response => response.json())
    .then(data => {
        localStorage.setItem("login data", JSON.stringify(login_data))
        localStorage.removeItem("cart")
        pay_button.innerHTML = `<dotlottie-player id="anim" src="https://lottie.host/a69dfd67-5d73-4bb0-8c7f-d93705d64c43/mxM3JieP9l.lottie" background="transparent" speed="0.8" autoplay></dotlottie-player>`
        window.location.href = "index.html"
    });
}